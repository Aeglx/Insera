# 保险出单数据统计系统

## 项目概述
本系统用于统计保险公司每日出单数据，并提供上年同期对比功能。

## 主要功能
- 每日出单数据统计
- 30天趋势分析
- 上年同期数据对比
- 数据可视化展示

## 统计规则说明

### 出单数统计
1. **统计对象**：
   - 新出保单（不包括续保保单）
   - 以车架号/VIN码、发动机号、车牌号作为唯一标识

2. **统计逻辑**：
   ```sql
   COUNT(DISTINCT COALESCE(`车架号/VIN码`, 发动机号, 车牌号)) AS 出单台次
   ```

3. **数据来源**：
   - 本年数据：xubao表
   - 上年同期数据：yuanshuju表

### 日期范围计算
1. **当前年统计**：
   - 日期范围：当天往前30天（含当天）
   - 示例：2025-06-01统计范围为2025-05-02至2025-06-01

2. **上年同期**：
   - 日期范围：去年同一天往前30天
   - 示例：2025-06-01的上年同期为2024-05-02至2024-06-01

### 数据过滤条件
1. 必须至少有以下一项标识：
   - 车架号/VIN码
   - 发动机号
   - 车牌号

2. 排除条件：
   - 三项标识均为空的记录
   - 续保保单（根据业务规则）

## 安装部署

### 环境要求
- PHP 7.4+
- MySQL 5.7+
- Web服务器（Apache/Nginx）

### 部署步骤
1. 克隆仓库：
   ```bash
   git clone [仓库地址]
   ```
2. 安装依赖：
   ```bash
   composer install
   ```
3. 配置数据库：
   - 修改`config/database.php`
4. 导入数据：
   ```bash
   mysql -u username -p database_name < data.sql
   ```

## 使用说明
1. 访问首页查看数据总览
2. 使用日期选择器调整统计范围
3. 点击"刷新数据"更新统计结果

## 注意事项
1. 确保数据库中有完整的支付日期数据
2. 上年同期数据依赖yuanshuju表的完整性
3. 系统自动排除三项标识均为空的记录
4. 续保保单不计入出单统计

## 常见问题
Q: 为什么上年同期没有数据？
A: 请检查：
   - yuanshuju表是否有对应日期数据
   - 数据是否满足标识条件
   - 日期范围计算是否正确

Q: 如何确认统计的是出单数而非续保数？
A: 系统已明确：
   - 只统计新出保单
   - 续保保单有单独标识字段
   - 统计结果中不包含续保数据